<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="format-detection" content="telephone=no">
    <title>万达筑云项目管理平台</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta content="black-translucent" name="apple-mobile-web-app-status-bar-style" />
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">
    <!--<link rel="stylesheet" type="text/css" href="js/libs/slick-1.8.0/slick/slick.css" />-->
    <link rel="stylesheet" type="text/css" href="css/comm.css" />
    <link rel="stylesheet" type="text/css" href="css/index.css" />
    <link rel="stylesheet" type="text/css" href="css/Awesome/css/font-awesome.css" />
    <!--todo carousel libraries-->
    <!--<link rel="stylesheet" href="js/libs/PhotoSwipe/photoswipe.css">-->
    <!--<link rel="stylesheet" href="js/libs/PhotoSwipe/default-skin/default-skin.css">-->
</head>

<body>
    <div id="mainHeader" class="mainHeader">
        <div class="mobileBar"></div>
        <header>
            <div class="header-close">
                <a href="javascript:;" id="closeBtn">
                    <span class="header-close-1"></span>
                    <span class="header-close-2"></span>
                </a>
            </div>
            <div class="header-return">
                <a href="javaScript:;">
                    <span class="header-left">
                        <span class="header-left-inner"></span>
                    </span>
                </a>
            </div>
            <span id="mainHeaderTitle">万达筑云项目管理平台</span>
            <div class="header-popMenu-home">
                <a href="#/index">&nbsp;</a>
            </div>
            <div class="header-popMenu">
                <i></i>
                <i></i>
                <i></i>
            </div>
            <div id="headerPopMenu" class="headerPopMenu">
                <div class="arrow"></div>
                <div class="popMenuContent"></div>
            </div>
        </header>
    </div>
    <section id="mainContainer" class="mainContainer">

    </section>
    <footer>
        <div class="footerBox" id="footerBox">
            <div class="footer-box footer-box-select">
                <a href="#/index">
                    <i class="footer-box-home"></i>
                    <span>首页</span>
                </a>
            </div>
            <div class="footer-box">
                <a href="#/Projects">
                    <i class="footer-box-model"></i>
                    <span>图纸模型</span>
                </a>
            </div>
            <div class="footer-box">
                <a href="#/flow">
                    <i class="footer-box-flow"></i>
                    <span>业务流程</span>
                </a>
            </div>
            <div class="footer-box">
                <a href="#/resource">
                    <i class="footer-box-resource"></i>
                    <span>资源</span>
                </a>
            </div>
            <div class="footer-box">
                <a href="#/service">
                    <i class="footer-box-service"></i>
                    <span>服务</span>
                    <span id="noReadNum" style="top: 0.2rem;right: 0.5rem;"></span>
                </a>
            </div>
        </div>
    </footer>


    <!--all dialog doms-->
    <div class="common_commDialog">
        <div class="commDialogContainer"></div>
        <div class="commDialogButtons">
            <div class="commDialogCancel">取消</div>
            <div class="commDialogOk">确定</div>
        </div>
    </div>
    <!-- 四方注册弹出 -->
    <div class="tipDialogBox" id="tipDialogBox">
        <div class="tipLeftLogoBox">
            <img src="images/comm/icon_sifang.png">
        </div>
        <div class="tipRightLogoBox">
            <p id="dialogMessage"></p>
        </div>
    </div>
    <!-- 四方注册弹出 -->
</body>

</html>
<script type="text/javascript" src="js/libs/js/cordova.js"></script>
<script type="text/javascript" src='js/libs/views/core.min.js'></script>
<script type="text/javascript" src='js/libs/underscore/underscore.min.js'></script>
<script type="text/javascript" src='js/libs/views/three.js'></script>
<script type="text/javascript" src="js/libs/views/WebViewer.js"></script>
<script type="text/javascript" src="js/libs/views/WebViewer.plugins.js"></script>
<script type="text/javascript" src="js/libs/views/Web2d.js"></script>
<script type="text/javascript" src="js/libs/jquery-3.1.1.min.js"></script>
<script type="text/javascript" src="js/libs/js/jquery.cookie.js"></script>
<script type="text/javascript" src="js/libs/FrontEndFrameWork.js"></script>
<!-- <script type="text/javascript" src="js/libs/iscrolls/iscroll.js"></script> -->
<script type="text/javascript" src="js/libs/iscrolls/iscroll-probe.js"></script>
<!--<script type="text/javascript" src="js/libs/iscrolls/iscroll-zoom.js"></script>-->
<!-- Core JS file -->

<!-- UI JS file -->
<!--todo carousel libraries-->
<!--<script src="js/libs/PhotoSwipe/photoswipe.js"></script>-->
<!--<script src="js/libs/PhotoSwipe/photoswipe-ui-default.js"></script>-->
<script type="text/javascript" src="js/App.js"></script>
<script type="text/javascript" src="js/Url.js"></script>
<script type="text/javascript" src="js/common/bimView.js"></script>
<script type="text/javascript" src="js/common/famLibsView.js"></script>
<script type="text/javascript" src="js/common/Assister.js"></script>
<script type="text/javascript" src="js/common/wGate.min.js"></script>
<script type="text/javascript" src="js/publish_config.js"></script>
<script src="js/comm.statistics.es6.js"></script>
<script type="text/javascript" src='js/libs/hammer/hammer.min.js'></script>
<script type="text/javascript" src="js/config.js"></script>
<script type="text/javascript">
    $(function () {
        window.checkCookieHandle.init();//执行检查用户cookie的方法
        window.addStatisticsHandle.init();//添加统计js方法
        App.getNewsNumHandle(function (data) {
            var noReadNum = $("#noReadNum");
            if (data !== 0) {
                noReadNum.html(data).css("display", "block");
            }
        }); //获取未读消息方法
    })
        ; (function ($, win, doc) {
            var checkCookieHandle = {//执行检查用户cookie的方法
                defaults: {
                    isIp: false,
                    isInnerUser: "",
                    domainStr: "",//存储cookie使用的domain
                    isCookie: ""//是否存在当前第一次的cookie
                },
                init: function () {
                    var _this = this;
                    // alert(document.cookie);
                    this.defaults.isInnerUser = this.checkUserHandle();//检查用户是外网换是内网
                    if (this.defaults.isInnerUser) {//如果是内网用户
                        this.defaults.isCookie = $.cookie("isCookie");
                        this.checkHostHandle();//检查是域名登录换是ip登录
                        if (!this.defaults.isCookie) {
                            var outerCookie = ["AuthUser_AuthMAC", "AuthUser_AuthNum", "AuthUser_AuthToken", "OUTSSO_AuthMAC", "OUTSSO_AuthNum", "OUTSSO_AuthToken", "OUTSSO_SourceType", "bim_outer_loginid", "loginid", "pcDebug", "AuthUser_AuthToken1", "ostype", "yesKnow"];//外部用户清楚的数组
                            for (var i = 0, len = outerCookie.length; i < len; i++) {
                                this.clearCookieHandle(outerCookie[i]);//清楚cookie
                            }
                            if (!this.defaults.isIp) {
                                this.setCookieHandle();//设置合作方使用的cookie比如模块化
                            }
                            this.setIsCookieHandle();//设置是不是第一次进入到首页
                        }
                    }
                },
                checkUserHandle: function () {//检查用户是外网换是内网
                    var result = true;//模式是内网用户
                    var cookieName = "userId";
                    if ($.cookie(cookieName)) {
                        result = true;
                    } else {
                        result = false;
                    }
                    return result;
                },
                checkHostHandle: function () {//检查是域名登录换是ip登录
                    var hostname = window.location.hostname;
                    var re = /^(\d+)\.(\d+)\.(\d+)\.(\d+)$/;//正则表达式
                    // var reg = /\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}/;
                    if (re.test(hostname)) {
                        this.defaults.domainStr = hostname;
                        this.defaults.isIp = true;
                    } else {
                        this.defaults.domainStr = hostname.substring(hostname.indexOf("."));
                        this.defaults.isIp = false;
                    }
                },
                setIsCookieHandle: function () {//设置是不是第一次进入到首页
                    $.cookie("isCookie", "1", {
                        path: '/',
                        domain: this.defaults.domainStr
                    })
                },
                setCookieHandle: function () {//设置合作方使用的cookie比如模块化
                    var domainStr = this.defaults.domainStr;
                    var Days = 1, //0.02
                        exp = new Date();
                    exp.setTime(exp.getTime() + Days * 24 * 60 * 60 * 1000);
                    var cookies = document.cookie;
                    var cookieArr = cookies.split("; ");
                    for (var i = 0, len = cookieArr.length; i < len; i++) {
                        var arrCookie = cookieArr[i].split("=");
                        document.cookie = arrCookie[0] + "=" + arrCookie[1] + ";expires=" + exp.toGMTString() + ";domain=" + domainStr + ";path=/";
                    }
                },
                clearCookieHandle: function (name) {//清楚cookie
                    var exp = new Date();
                    exp.setTime(exp.getTime() - 31 * 24 * 60 * 60 * 1000);
                    var cval = this.getCookieHandle(name);
                    if (cval != null)
                        document.cookie = name + "=" + cval + ";expires=" + exp.toGMTString() + ";domain=" + this.defaults.domainStr + ";path=/";
                },
                getCookieHandle: function (key, cookis) {
                    var cooks = cookis || document.cookie,
                        items = cooks.split("; "),
                        result,
                        len = items.length,
                        str, pos;
                    for (var i = 0; i < len; i++) {
                        str = items[i];
                        pos = str.indexOf('=');
                        name = str.substring(0, pos);
                        if (name == key) {
                            result = str.substring(pos + 1);
                            break;
                        }
                    }
                    return result;
                }
            }
            var addStatisticsHandle = {
                init: function () {
                    var _this = this;
                    var xmlAjax = new XMLHttpRequest();
                    xmlAjax.open("GET", '/platform/video/url', true);
                    xmlAjax.send();
                    xmlAjax.onreadystatechange = function () {
                        if (xmlAjax.readyState == 4 && xmlAjax.status == 200) {
                            var responseJosn = JSON.parse(xmlAjax.responseText);
                            var resObj = responseJosn.data[0].content;
                            _this.addJsUrlHandle(resObj.common, "head", function () {
                                console.log("加载统计代码完成了")
                            })
                        }
                    }
                },
                addJsUrlHandle: function (jsUrl, type, callback) {//添加js脚本的方法
                    var script = document.createElement('script');
                    script.type = 'text/javascript';
                    script.src = jsUrl;
                    if (type == "head") {
                        document.head.appendChild(script);
                    }
                    script.onload = function () {
                        callback();
                    }
                }
            }
            win.checkCookieHandle = checkCookieHandle;//执行检查用户cookie的方法
            win.addStatisticsHandle = addStatisticsHandle;//执行检查用户cookie的方法
        })(jQuery, window, document)
</script>